<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar SCADA System</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-secondary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-solar-panel text-warning me-2"></i>
                <span class="scada-font text-warning">SOLAR</span><span class="scada-font">SCADA</span>
            </a>
            <div class="d-flex align-items-center">
                <span class="badge bg-success me-3 pulse"><i class="fas fa-circle me-1"></i> SYSTEM ONLINE</span>
                <span id="clock" class="text-light font-monospace">--:--:--</span>
            </div>
        </div>
    </nav>

    <div class="container-fluid p-0">
        <div class="row g-0" style="height: calc(100vh - 56px);">
            
            <!-- Sidebar / Plant List -->
            <div class="col-md-3 col-lg-2 bg-dark border-end border-secondary d-flex flex-column">
                <div class="p-3 border-bottom border-secondary">
                    <h6 class="text-uppercase text-muted mb-2">Plants Overview</h6>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="h4 mb-0" id="total-power">0.0 kW</span>
                        <small class="text-success"><i class="fas fa-arrow-up"></i> Total</small>
                    </div>
                </div>
                
                <div class="flex-grow-1 overflow-auto" id="plant-list">
                    <!-- Plant items will be injected here -->
                    <div class="text-center p-4 text-muted">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">Loading plants...</p>
                    </div>
                </div>
                
                <div class="p-3 border-top border-secondary bg-black">
                    <small class="text-muted">System Status: <span class="text-success">Connected</span></small>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 d-flex flex-column bg-black position-relative">
                
                <!-- Map View (Default) -->
                <div id="map-view" class="flex-grow-1 position-relative">
                    <div id="map" style="height: 100%; width: 100%;"></div>
                    
                    <!-- Overlay Stats -->
                    <div class="position-absolute top-0 end-0 m-3 p-3 bg-dark bg-opacity-75 rounded border border-secondary" style="z-index: 1000; min-width: 250px;">
                        <h6 class="text-uppercase text-warning mb-3">Global Metrics</h6>
                        <div class="mb-2">
                            <small class="text-muted d-block">Active Plants</small>
                            <span class="h5" id="active-plants-count">0</span> / <span id="total-plants-count">0</span>
                        </div>
                        <div>
                            <small class="text-muted d-block">Avg Efficiency</small>
                            <span class="h5 text-info">98.2%</span>
                        </div>
                    </div>
                </div>

                <!-- Detail View (Hidden by default) -->
                <div id="detail-view" class="d-none flex-grow-1 overflow-auto p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <button class="btn btn-outline-secondary btn-sm mb-2" onclick="showMap()"><i class="fas fa-arrow-left"></i> Back to Map</button>
                            <h2 class="scada-font text-white mb-0" id="detail-name">Plant Name</h2>
                            <div class="d-flex align-items-center mt-1">
                                <small class="text-muted me-3" id="detail-id">ID: plant_1</small>
                                <span class="badge bg-dark border border-secondary text-light" id="detail-local-time">--:--</span>
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="mb-2" id="weather-icon-container">
                                <!-- Icon injected by JS -->
                            </div>
                            <span class="badge bg-success fs-6" id="detail-status">RUNNING</span>
                        </div>
                    </div>

                    <!-- KPI Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card bg-dark border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-bolt text-warning me-2"></i>Power Output</h6>
                                    <h3 class="card-title text-warning mb-0" id="detail-power">0.00 kW</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-dark border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-plug text-info me-2"></i>Voltage</h6>
                                    <h3 class="card-title text-white mb-0" id="detail-voltage">0.0 V</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-dark border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-wave-square text-primary me-2"></i>Frequency</h6>
                                    <h3 class="card-title text-white mb-0" id="detail-frequency">0.00 Hz</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-dark border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-thermometer-half text-danger me-2"></i>Temperature</h6>
                                    <h3 class="card-title text-white mb-0" id="detail-temp">0.0 Â°C</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                             <div class="card bg-dark border-secondary h-100">
                                <div class="card-body d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-leaf text-success me-2"></i>Efficiency</h6>
                                        <h3 class="card-title text-white mb-0" id="detail-efficiency">0.0 %</h3>
                                    </div>
                                    <div class="text-end">
                                        <small class="text-muted">Daily Energy</small>
                                        <h4 class="text-info mb-0" id="detail-energy">0.00 kWh</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <!-- Charts -->
                        <div class="col-lg-8">
                            <div class="card bg-dark border-secondary mb-4">
                                <div class="card-header border-secondary bg-transparent">
                                    <h6 class="mb-0">Power Generation History (Real-time)</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="powerChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Info Panel -->
                        <div class="col-lg-4">
                            <div class="card bg-dark border-secondary mb-4">
                                <div class="card-header border-secondary bg-transparent">
                                    <h6 class="mb-0">Technical Details</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush bg-transparent">
                                        <li class="list-group-item bg-transparent text-light d-flex justify-content-between border-secondary">
                                            <span>Current</span>
                                            <span class="font-monospace" id="detail-current">0.00 A</span>
                                        </li>
                                        <li class="list-group-item bg-transparent text-light d-flex justify-content-between border-secondary">
                                            <span>Nominal Power</span>
                                            <span class="font-monospace" id="detail-nominal">0.00 kW</span>
                                        </li>
                                        <li class="list-group-item bg-transparent text-light d-flex justify-content-between border-secondary">
                                            <span>Location</span>
                                            <span class="font-monospace" id="detail-location">0.0, 0.0</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Solar Panel Visual -->
                            <div class="card bg-dark border-secondary">
                                <div class="card-header border-secondary bg-transparent">
                                    <h6 class="mb-0">Array Visualization</h6>
                                </div>
                                <div class="card-body text-center position-relative overflow-hidden" style="height: 200px;">
                                    <div class="solar-array">
                                        <div class="panel"></div>
                                        <div class="panel"></div>
                                        <div class="panel"></div>
                                        <div class="panel"></div>
                                        <div class="panel"></div>
                                        <div class="panel"></div>
                                    </div>
                                    <div class="sun-overlay" id="sun-visual"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/app.js"></script>
</body>
</html>